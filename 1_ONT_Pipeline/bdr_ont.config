## ---------------------------
##
## Author: Szi Kay Leung
##
## Email: S.K.Leung@exeter.ac.uk
##
## ---------------------------

## ---------------------------

## Output name and relevant info
export NAME=AllBDRTargeted
export SAMPLE_NUM=53
export SPECIES=hg38

## Output root directory filepath (ensure path exists)
export WKD_ROOT=/lustre/projects/Research_Project-MRC148213/lsl693/AD_BDR/D_ONT
export META_ROOT=/lustre/projects/Research_Project-MRC148213/lsl693/AD_BDR/0_metadata/B_ONT
export UTILS=/lustre/projects/Research_Project-MRC148213/lsl693/scripts/AD_BDR/0_utils

# Annotation 
TGENES=(ABCA1 SORL1 MAPT BIN1 TARDBP APP ABCA7 PTK2B ANK1 FYN CLU CD33 FUS PICALM SNCA APOE TRPA1 RHBDF2 TREM2 VGF)
TGENES_TXT=${UTILS}/TargetGenes.tsv
REF_DATASET=ADBDR


## ---------------------------

## Source functions and scripts directory 
export SC_ROOT=/lustre/projects/Research_Project-MRC148213/lsl693/scripts/AD_BDR
export GENERALFUNC=/lustre/projects/Research_Project-MRC148213/lsl693/scripts/General/2_Transcriptome_Annotation
export LOGEN_ROOT=//lustre/projects/Research_Project-MRC148213/lsl693/scripts/LOGen


## ---------------------------

## Reference 
export REFERENCE=/lustre/projects/Research_Project-MRC148213/lsl693/references
# wget https://hgdownload.soe.ucsc.edu/goldenPath/hg38/bigZips/hg38.fa.gz; gunzip hg38.fa.gz
export GENOME_FASTA=$REFERENCE/human/hg38.fa
# wget https://ftp.ebi.ac.uk/pub/databases/gencode/Gencode_human/release_40/gencode.v40.annotation.gtf.gz; gunzip gencode.v40.annotation.gtf.gz
export GENOME_GTF=$REFERENCE/annotation/gencode.v40.annotation.gtf


# Primers and Probes
export FASTA=$UTILS/primer.fasta
export TARGETED_FASTA=$UTILS/Primers/targeted.primer.fasta
export PROBES=$UTILS/Probes_hg38.bed


## ---------------------------

## Long read data (ONT Targeted)
export RAW_ROOT_DIR=/lustre/projects/Research_Project-MRC148213/lsl693/AD_BDR/1_raw/B_ONT
#export RAW_FASTQ_1=${RAW_ROOT_DIR}/P0063_20221026_100859/BDR_enriched/20221026_1304_2F_PAM95037_d0bc299c/fastq_pass  # P0063_20221026_100859
#export RAW_FASTQ_2=${RAW_ROOT_DIR}/P0063_20221031_10859/BDR_enriched/20221031_1830_2F_PAM95037_04a8d91e/fastq_pass   # P0063_20221031_10859

export RAW_FASTQ_3=/lustre/projects/Research_Project-MRC190311/longReadSeq/ONTRNA/Targeted_transcriptome/10918/P0073_20230209_10918/BDR/20230209_1549_3F_PAK63174_1ae1cd51/fastq_pass            # P0073_20230209_10918

export BATCH_NAMES=(Targeted_Seq_1 Targeted_Seq_2)
export BAM_FILES=($RAW_BAM_1 $RAW_BAM_2)

# For Demultiplexing Samples
BARCODE_CONFIG=$SC_ROOT/1_ONT_Pipeline/bdr_ont_barocde.csv
ALL_SAMPLES_NAMES=($(awk -F "\"*,\"*" '{print $1}' ${BARCODE_CONFIG}))

# Sorted nuclei data (processed by R.Bamford; merged and mapped)
export SortedBAM=/gpfs/mrc0/projects/Research_Project-MRC148213/Rosie/SortedNuclei/RNA/P0075_20230216_10916/adult_sorted_nuclei/20230216_1558_1G_PAK65840_66586f9d/combined/merged.bam

export GRPPHENOTYPE=${META_ROOT}/ADBDR_Batch1Phenotype_Grouping.csv

## ---------------------------

# Short read data (RNA-Seq)
RNASEQ_FILTERED_DIR=/lustre/projects/Research_Project-193356/Project_10202/11_fastp_trimmed
RNASEQ_SAMPLES_NAMES=$(awk '{print $1}' $SC_ROOT/1_IsoSeq_Pipeline/bdr_rnaseq_samples.tsv)
RNASEQ_MAPPED_DIR=/lustre/projects/Research_Project-MRC148213/lsl693/AD_BDR/B_RNASeq/MAPPED
RNASEQ_COUNTS=/lustre/projects/Research_Project-MRC148213/lsl693/AD_BDR/B_RNASeq/ADBDR_Darren_genecounts.csv

## ---------------------------

## Software 
export SOFTDIR=/lustre/projects/Research_Project-MRC148213/lsl693/software

export MINIONQC=${SOFTDIR}/minion_qc/MinIONQC.R
# to run Porechop, require gcc-version 4.9.1 or more; 
# on Knight: git clone https://github.com/rrwick/Porechop.git; cd Porechop; make
# transfer whole Porechop folder from Knight to ISCA, and chmod 
export PORECHOP=${SOFTDIR}/Porechop/porechop-runner.py
export TCLEAN=${SOFTDIR}/TranscriptClean/TranscriptClean.py
export CUPCAKE=${SOFTDIR}/cDNA_Cupcake
export ANNOTATION=$CUPCAKE/annotation
export SEQUENCE=$CUPCAKE/sequence
export PYTHONPATH=$PYTHONPATH:$SEQUENCE
export SQANTI3_DIR=${SOFTDIR}/SQANTI3
export TAPPAS_dir=${SOFTDIR}/TAPPAS
export TAMA_DIR=${SOFTDIR}/tama/tama_go/filter_transcript_models
export ISOANNOT=${SOFTDIR}/SQANTI3/utilities/IsoAnnotLite_SQ3.py

## ---------------------------

## Software input files
# SQANTI3 input files
CAGE_PEAK=$SQANTI3_DIR/data/ref_TSS_annotation/human.refTSS_v3.1.hg38.bed
POLYA=$SQANTI3_DIR/data/polyA_motifs/mouse_and_human.polyA_motif.txt


# CPAT input files
export HEXAMER=${REFERENCE}/CPAT/Human_Hexamer.tsv
export LOGITMODEL=${REFERENCE}/CPAT/Human_logitModel.RData

## ---------------------------

## Internal Scripts 
SUBSETPOLYTAILS=$LOGEN_ROOT/assist_ont_processing/subset_polyA_polyT.py


## ---------------------------
cd ${WKD_ROOT}
mkdir -p 1_demultiplex 1b_demultiplex_merged 2_cutadapt_merge 3_minimap 4_tclean 
mkdir -p ${WKD_ROOT}/1_demultiplex/Batch2